{% comment %}
  Include expects:
    - collections: comma-separated collection names (e.g., "home_computers, ibm_portables")
    - progress_values: comma-separated progress values to include (default: "done")
    - sort_fields: comma-separated fields to sort by (default: "released")
{% endcomment %}

{% assign collections = include.collections | split: "," %}
{% assign sort_fields = include.sort_fields | default: "released" | split: "," %}
{% assign progress_values = include.progress_values | default: "done" | split: "," %}

{% for collection_name in collections %}
  {% assign collection_items = site[collection_name] %}
  {% assign filtered_items = "" | split: "" %}
  
  {% for value in progress_values %}
    {% assign matching_items = collection_items | where: "progress", value %}
    {% assign filtered_items = filtered_items | concat: matching_items %}
  {% endfor %}

  {% assign sorted_items = filtered_items %}
  {% for field in sort_fields %}
    {% assign sorted_items = sorted_items | sort: field %}
  {% endfor %}

  <ul>
  {% for item in sorted_items %}
    <li>
      {% assign display_text = item.title %}
      {% if item.class %}
        {% assign display_text = display_text | append: " (" | append: item.class | append: "-class, released in " | append: item.released | append: ")" %}
      {% else %}
        {% assign display_text = display_text | append: " (released in " | append: item.released | append: ")" %}
      {% endif %}

      {% if item.documented == "stub" %}
        {{ display_text }} <em>— documentation pending</em>
      {% else %}
        <a href="{{ item.url | relative_url }}">{{ display_text }}</a>
        {% if item.documented != "done" %} <em>— documentation in progress</em>{% endif %}
      {% endif %}
    </li>
  {% endfor %}
  </ul>
{% endfor %}